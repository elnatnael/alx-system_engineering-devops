#!/usr/bin/env bash
# Sets up a 301 redirect for /redirect_me using Nginx on a new Ubuntu machine
#page redirect

# Install Nginx
sudo apt-get update -y -qq
sudo apt-get install -y nginx

# Start Nginx using service
sudo service nginx start

# Allow HTTP traffic through UFW
sudo ufw allow 'Nginx HTTP'

# Add redirect configuration to default site
CONFIG="/etc/nginx/sites-available/default"

if ! grep -q "location /redirect_me" "$CONFIG"; then
  sudo sed -i '/location \/ {/i \
location /redirect_me {\
    return 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\
}' "$CONFIG"
fi

sudo nginx -t || { echo "Nginx config test failed"; exit 1; }
sudo service nginx restart