#!/usr/bin/env bash
# Sets up a 301 redirect for /redirect_me using Nginx on a new Ubuntu machine

# Install Nginx
sudo apt-get update -y -qq
sudo apt-get install -y nginx

# Start Nginx using service
sudo service nginx start

# Allow HTTP traffic through UFW
sudo ufw allow 'Nginx HTTP'

# Add redirect configuration to default site
CONFIG="/etc/nginx/sites-available/default"

# Add redirect if not already present
if ! grep -q "location /redirect_me" "$CONFIG"; then
  sudo sed -i '/server_name _;/a \\\n\tlocation /redirect_me {\n\t\treturn 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\n\t}' "$CONFIG"
fi

# Restart Nginx
sudo service nginx restart
